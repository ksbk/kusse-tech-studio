<!-- Navigation JavaScript Functionality -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Mobile menu toggle
    const mobileMenuToggle = document.getElementById("mobile-menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    const mobileMenuContent = mobileMenu.querySelector("div");

    // Settings dropdown toggle
    const settingsToggle = document.getElementById("settings-toggle");
    const settingsMenu = document.getElementById("settings-menu");

    if (mobileMenuToggle && mobileMenu) {
      mobileMenuToggle.addEventListener("click", function () {
        const isExpanded = this.getAttribute("aria-expanded") === "true";

        // Toggle aria-expanded
        this.setAttribute("aria-expanded", !isExpanded);

        // Toggle menu visibility
        mobileMenuContent.classList.toggle("hidden");

        // Update button icon
        const icon = this.querySelector("svg");
        if (mobileMenuContent.classList.contains("hidden")) {
          // Menu icon
          icon.innerHTML =
            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>';
        } else {
          // Close icon
          icon.innerHTML =
            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>';
        }
      });
    }

    // Settings dropdown functionality
    if (settingsToggle && settingsMenu) {
      settingsToggle.addEventListener("click", function (e) {
        e.stopPropagation();
        const isExpanded = this.getAttribute("aria-expanded") === "true";

        // Toggle dropdown
        this.setAttribute("aria-expanded", !isExpanded);
        settingsMenu.classList.toggle("hidden");
      });
    }

    // Close dropdowns when clicking outside
    document.addEventListener("click", function (event) {
      // Close mobile menu
      if (
        mobileMenu &&
        !mobileMenu.contains(event.target) &&
        !mobileMenuToggle.contains(event.target)
      ) {
        mobileMenuContent.classList.add("hidden");
        mobileMenuToggle.setAttribute("aria-expanded", "false");
        const icon = mobileMenuToggle.querySelector("svg");
        icon.innerHTML =
          '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>';
      }

      // Close settings menu
      if (
        settingsMenu &&
        !settingsMenu.contains(event.target) &&
        !settingsToggle.contains(event.target)
      ) {
        settingsMenu.classList.add("hidden");
        settingsToggle.setAttribute("aria-expanded", "false");
      }
    });

    // Close mobile menu when window is resized to desktop
    window.addEventListener("resize", function () {
      if (window.innerWidth >= 768) {
        // md breakpoint
        mobileMenuContent.classList.add("hidden");
        mobileMenuToggle.setAttribute("aria-expanded", "false");
        const icon = mobileMenuToggle.querySelector("svg");
        icon.innerHTML =
          '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>';

        // Also close settings menu
        settingsMenu.classList.add("hidden");
        settingsToggle.setAttribute("aria-expanded", "false");
      }
    });

    // Active page highlighting
    function setActiveNavItem() {
      const currentPage = window.location.pathname;
      const navLinks = document.querySelectorAll(".nav-link, .mobile-nav-link");

      navLinks.forEach((link) => {
        const linkPage = link.getAttribute("href");

        // Remove active classes
        link.classList.remove("text-blue-600", "dark:text-blue-400");

        // Check if current page matches link
        if (
          currentPage === linkPage ||
          (currentPage === "/" && linkPage === "/") ||
          (currentPage.startsWith("/projects") && linkPage === "/projects/") ||
          (currentPage.startsWith("/contact") && linkPage === "/contact/")
        ) {
          // Add active state for desktop nav
          if (link.classList.contains("nav-link")) {
            link.classList.add("text-blue-600", "dark:text-blue-400");
            // Add active underline
            const underline = link.querySelector("span");
            if (underline) {
              underline.classList.add("w-full");
            }
          }

          // Add active state for mobile nav
          if (link.classList.contains("mobile-nav-link")) {
            link.classList.add(
              "text-blue-600",
              "dark:text-blue-400",
              "bg-blue-50",
              "dark:bg-blue-900/20",
            );
          }
        }
      });
    }

    // Set active nav item on page load
    setActiveNavItem();

    // Header scroll behavior
    let lastScrollTop = 0;
    const header = document.getElementById("main-header");

    window.addEventListener("scroll", function () {
      const scrollTop =
        window.pageYOffset || document.documentElement.scrollTop;

      // Add/remove shadow based on scroll position
      if (scrollTop > 10) {
        header.classList.add("shadow-md");
        header.classList.remove("shadow-sm");
      } else {
        header.classList.remove("shadow-md");
        header.classList.add("shadow-sm");
      }

      // Hide/show header on scroll (optional)
      if (scrollTop > lastScrollTop && scrollTop > 100) {
        // Scrolling down
        header.style.transform = "translateY(-100%)";
      } else {
        // Scrolling up
        header.style.transform = "translateY(0)";
      }

      lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
    });
  });
</script>

<!-- Navigation Styles -->
<style>
  /* Smooth transitions for header */
  #main-header {
    transition:
      transform 0.3s ease-in-out,
      box-shadow 0.3s ease-in-out;
  }

  /* Enhanced hover effects */
  .nav-link:hover span {
    width: 100% !important;
  }

  /* Mobile menu animations */
  #mobile-menu > div {
    transition: all 0.3s ease-in-out;
  }

  /* Logo hover effect - enhanced for KTS reveal */
  .group:hover .w-10 {
    transform: scale(1.05);
  }

  /* Settings dropdown animations */
  #settings-menu {
    transition:
      opacity 0.2s ease-in-out,
      transform 0.2s ease-in-out;
    transform-origin: top right;
  }

  #settings-menu.hidden {
    opacity: 0;
    transform: scale(0.95);
  }

  #settings-menu:not(.hidden) {
    opacity: 1;
    transform: scale(1);
  }

  /* Logo text reveal animation */
  .group .opacity-0 {
    transition:
      opacity 0.3s ease-in-out,
      transform 0.3s ease-in-out;
  }

  .group:hover .opacity-0 {
    opacity: 1 !important;
    transform: translateX(0) !important;
  }

  /* Backdrop blur support check */
  @supports not (backdrop-filter: blur(12px)) {
    #main-header {
      background: rgba(255, 255, 255, 0.98);
    }

    .dark #main-header {
      background: rgba(17, 24, 39, 0.98);
    }
  }
</style>
