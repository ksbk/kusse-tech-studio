<!-- Dark Mode JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Dark mode functionality
    const themeToggle = document.getElementById('theme-toggle');
    const mobileThemeToggle = document.getElementById('mobile-theme-toggle');
    const darkModeToggleAlt = document.getElementById('dark-mode-toggle');
    
    // Check for saved dark mode preference or default to system preference
    function initDarkMode() {
        if (localStorage.getItem('darkMode') === 'true' || 
            (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    }
    
    // Toggle dark mode
    function toggleDarkMode() {
        document.documentElement.classList.toggle('dark');
        const isDark = document.documentElement.classList.contains('dark');
        localStorage.setItem('darkMode', isDark);
        
        // Update icons if needed
        updateThemeIcons();
        
        // Close settings menu after toggling
        const settingsMenu = document.getElementById('settings-menu');
        if (settingsMenu) {
            settingsMenu.classList.add('hidden');
            const settingsToggle = document.getElementById('settings-toggle');
            if (settingsToggle) {
                settingsToggle.setAttribute('aria-expanded', 'false');
            }
        }
    }
    
    // Update theme toggle icons
    function updateThemeIcons() {
        const isDark = document.documentElement.classList.contains('dark');
        
        // Update all theme toggles
        [themeToggle, mobileThemeToggle].forEach(toggle => {
            if (toggle) {
                const lightIcon = toggle.querySelector('.dark\\:hidden');
                const darkIcon = toggle.querySelector('.hidden.dark\\:block');
                const lightText = toggle.querySelector('.dark\\:hidden:not(svg)');
                const darkText = toggle.querySelector('.hidden.dark\\:inline');
                
                if (lightIcon && darkIcon) {
                    if (isDark) {
                        lightIcon.classList.add('hidden');
                        lightIcon.classList.remove('dark:hidden');
                        darkIcon.classList.remove('hidden');
                        darkIcon.classList.add('dark:block');
                    } else {
                        lightIcon.classList.remove('hidden');
                        lightIcon.classList.add('dark:hidden');
                        darkIcon.classList.add('hidden');
                        darkIcon.classList.remove('dark:block');
                    }
                }
                
                if (lightText && darkText) {
                    if (isDark) {
                        lightText.classList.add('hidden');
                        lightText.classList.remove('dark:hidden');
                        darkText.classList.remove('hidden');
                        darkText.classList.add('dark:inline');
                    } else {
                        lightText.classList.remove('hidden');
                        lightText.classList.add('dark:hidden');
                        darkText.classList.add('hidden');
                        darkText.classList.remove('dark:inline');
                    }
                }
            }
        });
        
        // Update alternative toggle if it exists
        if (darkModeToggleAlt) {
            const icon = darkModeToggleAlt.querySelector('i');
            if (icon) {
                if (isDark) {
                    icon.className = 'fas fa-sun';
                } else {
                    icon.className = 'fas fa-moon';
                }
            }
        }
    }
    
    // Initialize dark mode
    initDarkMode();
    updateThemeIcons();
    
    // Add event listeners
    if (themeToggle) {
        themeToggle.addEventListener('click', toggleDarkMode);
    }
    
    if (mobileThemeToggle) {
        mobileThemeToggle.addEventListener('click', toggleDarkMode);
    }
    
    if (darkModeToggleAlt) {
        darkModeToggleAlt.addEventListener('click', toggleDarkMode);
    }
    
    // Listen for system preference changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
        if (!localStorage.getItem('darkMode')) {
            if (e.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            updateThemeIcons();
        }
    });
});
</script>

<!-- Alternative floating dark mode toggle (hidden by default since we have header toggle) -->
<!-- 
<button id="dark-mode-toggle" class="fixed bottom-4 right-4 bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition-all duration-300 hover:scale-110 z-40 hidden">
    <i class="fas fa-moon"></i>
</button>
-->
